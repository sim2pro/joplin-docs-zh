

# 为什么 Joplin 会丢失文件？

我看到有用户说 Joplin 可能会在用户不知情的情况下，或者在同步的过程中，弄丢用户的文件？怎样可以避免，或者发现有丢文件的问题？

response:

关于 Joplin 可能丢失文件的问题，确实有少数用户报告过类似情况（多与同步冲突或操作不当有关）。以下是**原因分析**和**预防/排查方案**，帮助你最大限度避免风险：

---

### **一、可能的原因**
1. **同步冲突**  
   - 多设备同时修改同一笔记时，若同步逻辑处理不当（尤其是第三方同步服务如 Dropbox），可能导致版本覆盖。
   - **典型场景**：手机端离线修改笔记 → 电脑端同步时未检测到冲突 → 手机端同步后覆盖。

2. **文件系统权限问题**  
   - Joplin 无权限访问某些文件（如移动设备上的外部存储），导致同步失败但无提示。

3. **数据库损坏**  
   - 异常退出或存储设备故障可能导致 SQLite 数据库损坏，笔记“消失”（实际数据仍在，但无法加载）。

4. **误操作或过滤视图**  
   - 用户可能误删笔记或设置了筛选条件（如标签过滤），误以为文件丢失。

---

### **二、预防措施**
#### **1. 同步设置**
- **启用冲突检测**：  
  `设置 > 同步 > 同步间隔` 建议设置为较短时间（如 10 分钟），并勾选 `在同步时解决冲突`（Joplin 会保留冲突副本）。
- **选择可靠的同步服务**：  
  优先使用 Joplin 官方同步（付费）或 WebDAV（如 Nextcloud），比第三方云盘更稳定。
- **手动触发同步后检查日志**：  
  同步完成后，查看 `菜单 > 帮助 > 同步状态`，确认无错误。

#### **2. 定期备份**
- **导出备份（双重保险）**：  
  `文件 > 导出` 选择 `JEX 格式`（保留完整元数据）或 `Markdown + 资源文件`，存储到本地或异地。
- **自动备份插件**：  
  安装社区插件 `Joplin Backup`，设置定时自动备份到指定目录。

#### **3. 数据库维护**
- **修复数据库**：  
  异常关闭后，启动 Joplin 时会自动修复；也可手动通过 `菜单 > 工具 > 数据库 > 优化数据库`。
- **禁用硬件加速**（仅限故障时）：  
  部分显卡驱动可能导致界面卡顿/数据错误，尝试 `菜单 > 工具 > 选项 > 外观 > 禁用硬件加速`。

---

### **三、如何检查是否丢失文件**
1. **搜索确认**  
   - 使用全局搜索（`Ctrl + F`）尝试查找“丢失”笔记的关键词，确认是否被误移动或过滤。

2. **检查冲突笔记**  
   - 在笔记列表搜索 `conflict`，查看是否有自动保存的冲突副本。

3. **查看原始数据**  
   - Joplin 数据存储在本地 SQLite 数据库（路径：`设置 > 通用 > 显示高级设置 > 配置文件位置`）。  
   - 使用工具如 [DB Browser for SQLite](https://sqlitebrowser.org/) 打开 `database.sqlite`，检查 `notes` 表中是否存在“丢失”内容。

4. **同步日志分析**  
   - 查看日志文件（菜单 > 帮助 > 日志），搜索 `error` 或 `failed` 关键字，定位同步问题。

---

### **四、紧急恢复方案**
如果发现文件丢失：
1. **从备份恢复**  
   - 导入最近的 JEX 备份（`文件 > 导入`）。
2. **检查回收站**  
   - Joplin 默认保留删除的笔记 90 天（`设置 > 通用 > 已删除的笔记保留天数`）。
3. **手动恢复数据库**  
   - 关闭 Joplin，将 `database.sqlite` 替换为备份副本（位于配置文件夹内）。

---

### **五、其他建议**
- **避免直接操作存储文件**：手动修改 `~/.config/joplin/` 下的文件可能破坏数据库一致性。
- **关注 GitHub Issues**：查看 [Joplin 官方 Issues](https://github.com/laurent22/joplin/issues) 中类似问题的解决方案。

通过以上步骤，可以显著降低数据丢失风险。Joplin 的稳定性取决于同步服务和操作习惯，合理备份是关键保障。